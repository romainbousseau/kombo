<h1 class="text-center">Your Work Session</h1>
<hr>
<div class="container">
  <div class="row">
  <div class="test">
    <div class="col-xs-12 col-sm-8">
      <div class="card">
        <div class="brief text-center">
          <h2> Brief </h2>
          <%= @work_session.brief %>
        </div>
      </div>
       <div id="calendar" class="card"></div>
    </div>
    <div class="col-xs-12 col-sm-4">
      <%= render 'chat', work_session: @work_session, message: @message %>
      <% if current_user.id == @work_session.solver_user_id %>
        <% if @work_session.status == "pending" %>
          <%= link_to "Validate", validate_work_session_path(@work_session), class: "btn btn-success", method: :post %>
          <%= link_to "Decline", decline_work_session_path(@work_session), class: "btn btn-danger", method: :post %>
        <% end %>
      <% elsif current_user.id == @work_session.problem_user_id %>
        <% if @work_session.status == "validate" %>
          <%= link_to "Done", done_work_session_path(@work_session), class: "btn btn-warning", method: :post %>
        <% end %>
      <% end %>
    </div>

<%= content_for(:after_js) do %>
  <script>

    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,agendaWeek,agendaDay'
      },
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectHelper: true,
      select: function(start, end) {
        var title = prompt('Event Title:');
        var eventData;
        if (title) {
          eventData = {
            title: title,
            start: start,
            end: end
          };
          $('#calendar').fullCalendar('renderEvent', eventData, true); // stick? = true
        }
        $('#calendar').fullCalendar('unselect');
      },
      editable: true,
      eventLimit: true, // allow "more" link when too many events
    });

  $('#new_message').keydown(function(e) {
    var key = e.which;
    if (key == 13) {
    // As ASCII code for ENTER key is "13"
      $('#new_message').submit(); // Submit form code
      }
  });

  </script>
<% end %>
